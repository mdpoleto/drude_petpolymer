* $Id: test_drude_carbohydrate.str 28 2015-07-29 23:54:15Z alex $
* Test case, Drude carbohydrate toppar file
*

set boml 0 ! set to -1 if the series contains 3-membered rings

set nres 130

!polyols
set resi1 egly 
set seed1 1 O1 1 C1 1 C2
set resi2 mglyol 
set seed2 1 C1 1 C2 1 C3
set resi3 meryol
set seed3 1 C1 1 C2 1 C3
set resi4 dthrol
set seed4 1 C1 1 C2 1 C3
set resi5 lthrol
set seed5 1 C1 1 C2 1 C3
set resi6 mribol
set seed6 1 C1 1 C2 1 C3
set resi7 daraol
set seed7 1 C1 1 C2 1 C3
set resi8 laraol
set seed8 1 C1 1 C2 1 C3
set resi9 mxylol
set seed9 1 C1 1 C2 1 C3
set resi10 mallol 
set seed10 1 C1 1 C2 1 C3
set resi11 daltol
set seed11 1 C1 1 C2 1 C3
set resi12 laltol
set seed12 1 C1 1 C2 1 C3
set resi13 dgluol 
set seed13 1 C1 1 C2 1 C3
set resi14 lgluol
set seed14 1 C1 1 C2 1 C3
set seed15 1 C1 1 C2 1 C3
set resi15 dmanol
set seed15 1 C1 1 C2 1 C3
set resi16 lmanol
set seed16 1 C1 1 C2 1 C3
set resi17 dgulol 
set seed17 1 C1 1 C2 1 C3
set resi18 lgulol
set seed18 1 C1 1 C2 1 C3
set resi19 didiol 
set seed19 1 C1 1 C2 1 C3
set resi20 lidiol
set seed20 1 C1 1 C2 1 C3
set resi21 mgalol
set seed21 1 C1 1 C2 1 C3
!hexapyranoses
set resi22 aglc
set seed22 1 O5 1 C1 1 C2
set resi23 bglc
set seed23 1 O5 1 C1 1 C2
set resi24 aalt
set seed24 1 O5 1 C1 1 C2
set resi25 balt
set seed25 1 O5 1 C1 1 C2
set resi26 aall
set seed26 1 O5 1 C1 1 C2
set resi27 ball
set seed27 1 O5 1 C1 1 C2
set resi28 agal
set seed28 1 O5 1 C1 1 C2
set resi29 bgal
set seed29 1 O5 1 C1 1 C2
set resi30 agul
set seed30 1 O5 1 C1 1 C2
set resi31 bgul
set seed31 1 O5 1 C1 1 C2
set resi32 aido
set seed32 1 O5 1 C1 1 C2
set resi33 bido
set seed33 1 O5 1 C1 1 C2
set resi34 aman
set seed34 1 O5 1 C1 1 C2
set resi35 bman
set seed35 1 O5 1 C1 1 C2
set resi36 atal
set seed36 1 O5 1 C1 1 C2
set resi37 btal
set seed37 1 O5 1 C1 1 C2
!furanoses
set resi38 ARIB
set seed38 1 C4 1 O4 1 C1
set resi39 BRIB
set seed39 1 C4 1 O4 1 C1
set resi40 AARB
set seed40 1 C4 1 O4 1 C1
set resi41 BARB
set seed41 1 C4 1 O4 1 C1
set resi42 AXYF
set seed42 1 C4 1 O4 1 C1
set resi43 BXYF
set seed43 1 C4 1 O4 1 C1
set resi44 ALYF
set seed44 1 C4 1 O4 1 C1
set resi45 BLYF
set seed45 1 C4 1 O4 1 C1
set resi46 ADEO
set seed46 1 C4 1 O4 1 C1
set resi47 BDEO
set seed47 1 C4 1 O4 1 C1
set resi48 ALLO
set seed48 1 C1 1 C2 1 C3
set resi49 PSIC
set seed49 1 C1 1 C2 1 C3
set resi50 AFRU
set seed50 1 C5 1 O5 1 C2
set resi51 BFRU
set seed51 1 C5 1 O5 1 C2
!derivatives
set resi52  AGLCA
set seed52   1 O5 1 C1 1 C2
set resi53  BGLCA
set seed53   1 O5 1 C1 1 C2
set resi54  AGALA
set seed54   1 O5 1 C1 1 C2
set resi55  BGALA
set seed55   1 O5 1 C1 1 C2
set resi56  AIDOA
set seed56   1 O5 1 C1 1 C2
set resi57  BIDOA
set seed57   1 O5 1 C1 1 C2
set resi58  AGLCNA
set seed58   1 O5 1 C1 1 C2
set resi59  BGLCNA
set seed59   1 O5 1 C1 1 C2
set resi60  AGALNA
set seed60   1 O5 1 C1 1 C2
set resi61  BGALNA
set seed61   1 O5 1 C1 1 C2
set resi62  AMANNA
set seed62   1 O5 1 C1 1 C2
set resi63  BMANNA
set seed63   1 O5 1 C1 1 C2
!disac carbohydrate
set resi164  AARB
set resi264  AGLC
set patch64  PA11AA
set seed64   1 C4 1 O4 1 C1
set resi165  BARB
set resi265  AGLC
set patch65  PA11AB
set seed65   1 C4 1 O4 1 C1
set resi166  AARB
set resi266  BGLC
set patch66  PA11BA
set seed66   1 C4 1 O4 1 C1
set resi167  BARB
set resi267  BGLC
set patch67  PA11BB
set seed67   1 C4 1 O4 1 C1
set resi168  ARIB
set resi268  AGLC
set patch68  PA12AA
set seed68   1 C4 1 O4 1 C1
set resi169  AARB
set resi269  AGLC
set patch69  PA12AB
set seed69   1 C4 1 O4 1 C1
set resi170  BRIB
set resi270  BGLC
set patch70  PA12BA
set seed70   1 C4 1 O4 1 C1
set resi171  BARB
set resi271  BGLC
set patch71  PA12BB
set seed71   1 C4 1 O4 1 C1
set resi172  AARB
set resi272  AGLC
set patch72  PA13AA
set seed72   1 C4 1 O4 1 C1
set resi173  ALYF
set resi273  AGLC
set patch73  PA13AB
set seed73   1 C4 1 O4 1 C1
set resi174  AARB
set resi274  BGLC
set patch74  PA13BA
set seed74   1 C4 1 O4 1 C1
set resi175  BLYF
set resi275  BGLC
set patch75  PA13BB
set seed75   1 C4 1 O4 1 C1
set resi176  AARB
set resi276  AGLC
set patch76  PA15AB
set seed76   1 C4 1 O4 1 C1
set resi177  AARB
set resi277  BGLC
set patch77  PA15BB
set seed77   1 C4 1 O4 1 C1
set resi178  AARB
set resi278  AARB
set patch78  AA15AB
set seed78   1 C4 1 O4 1 C1
set resi179  AARB
set resi279  BARB
set patch79  AA15BB
set seed79   1 C4 1 O4 1 C1
set resi180  AGLC
set resi280  AGLC
set patch80  11AA
set seed80  1 O5 1 C1 1 C2
set resi181  AGLC
set resi281  BGLC
set patch81  11AB
set seed81  1 O5 1 C1 1 C2
set resi182  BGLC
set resi282  BGLC
set patch82  11BB
set seed82  1 O5 1 C1 1 C2
set resi183  AMAN
set resi283  AMAN
set patch83  12AA
set seed83  1 O5 1 C1 1 C2
set resi184  BGAL
set resi284  AGAL
set patch84  12AB
set seed84  1 O5 1 C1 1 C2
set resi185  AMAN
set resi285  BMAN
set patch85  12BA
set seed85  1 O5 1 C1 1 C2
set resi186  BGLC
set resi286  BGLC
set patch86  12BB
set seed86  1 O5 1 C1 1 C2
set resi187  AGUL
set resi287  AGUL
set patch87  13AA
set seed87  1 O5 1 C1 1 C2
set resi188  BMAN
set resi288  AMAN
set patch88  13AB
set seed88  1 O5 1 C1 1 C2
set resi189  AGUL
set resi289  BGUL
set patch89  13BA
set seed89  1 O5 1 C1 1 C2
set resi190  BGAL
set resi290  BGAL
set patch90  13BB
set seed90  1 O5 1 C1 1 C2
set resi191  BGAL
set resi291  AGAL
set patch91  14AA
set seed91  1 O5 1 C1 1 C2
set resi192  AGLC
set resi292  AGLC
set patch92  14AB
set seed92  1 O5 1 C1 1 C2
set resi193  BGAL
set resi293  BGAL
set patch93  14BA
set seed93  1 O5 1 C1 1 C2
set resi194  BGLC
set resi294  BGLC
set patch94  14BB
set seed94  1 O5 1 C1 1 C2
set resi195  AGLC
set resi295  AGLC
set patch95  16AB
set seed95  1 O5 1 C1 1 C2
set resi196  AGLC
set resi296  BGLC
set patch96  16BB
set seed96  1 O5 1 C1 1 C2
set resi197  AFRU
set resi297  AGLC
set patch97  16AB
set seed97  1 C5 1 O5 1 C2
set resi198  BFRU
set resi298  BGLC
set patch98  16BB
set seed98  1 C5 1 O5 1 C2
set resi199  AFRU
set resi299  AFRU
set patch99  FF26AB
set seed99  1 C5 1 O5 1 C2
set resi1100  AFRU
set resi2100  BFRU
set patch100  FF26BB
set seed100  1 C5 1 O5 1 C2
set resi1101  AFRU
set resi2101  AFRU
set patch101  FF21AB
set seed101  1 C5 1 O5 1 C2
set resi1102  AFRU
set resi2102  BFRU
set patch102  FF21AB
set seed102  1 C5 1 O5 1 C2
set resi1103  BFRU
set resi2103  AFRU
set patch103  FF21BB
set seed103  1 C5 1 O5 1 C2
set resi1104  BFRU
set resi2104  BFRU
set patch104  FF21BB
set seed104  1 C5 1 O5 1 C2
set resi1105  BFRU
set resi2105  AGLC
set patch105  PF13AB
set seed105  1 C5 1 O5 1 C2
set resi1106  BFRU
set resi2106  BGAL
set patch106  PF14BA
set seed106  1 C5 1 O5 1 C2
set resi1107  AGLC
set resi2107  AARB
set patch107  AP12AA
set seed107  1 O5 1 C1 1 C2
set resi1108  AMAN
set resi2108  AARB
set patch108  AP12AB
set seed108  1 O5 1 C1 1 C2
set resi1109  AGLC
set resi2109  BARB
set patch109  AP12BA
set seed109  1 O5 1 C1 1 C2
set resi1110  BMAN
set resi2110  BARB
set patch110  AP12BB
set seed110  1 O5 1 C1 1 C2
set resi1111  AGUL
set resi2111  AARB
set patch111  AP13AA
set seed111  1 O5 1 C1 1 C2
set resi1112  AMAN
set resi2112  AARB
set patch112  AP13AB
set seed112  1 O5 1 C1 1 C2
set resi1113  AGUL
set resi2113  BARB
set patch113  AP13BA
set seed113  1 O5 1 C1 1 C2
set resi1114  BMAN
set resi2114  BARB
set patch114  AP13BB
set seed114  1 O5 1 C1 1 C2
set resi1115  AGAL
set resi2115  AARB
set patch115  AP14AA
set seed115  1 O5 1 C1 1 C2
set resi1116  AGLC
set resi2116  AARB
set patch116  AP14AB
set seed116  1 O5 1 C1 1 C2
set resi1117  AGAL
set resi2117  BARB
set patch117  AP14BA
set seed117  1 O5 1 C1 1 C2
set resi1118  BGLC
set resi2118  BARB
set patch118  AP14BB
set seed118  1 O5 1 C1 1 C2
set resi1119  BGLC
set resi2119  AARB
set patch119  AP12AA
set seed119  1 O5 1 C1 1 C2
set resi1120  BMAN
set resi2120  AARB
set patch120  AP12AB
set seed120  1 O5 1 C1 1 C2
set resi1121  BGLC
set resi2121  BARB
set patch121  AP12BA
set seed121  1 O5 1 C1 1 C2
set resi1122  AMAN
set resi2122  BARB
set patch122  AP12BB
set seed122  1 O5 1 C1 1 C2
set resi1123  BGUL
set resi2123  AARB
set patch123  AP13AA
set seed123  1 O5 1 C1 1 C2
set resi1124  BMAN
set resi2124  AARB
set patch124  AP13AB
set seed124  1 O5 1 C1 1 C2
set resi1125  BGUL
set resi2125  BARB
set patch125  AP13BA
set seed125  1 O5 1 C1 1 C2
set resi1126  AMAN
set resi2126  BARB
set patch126  AP13BB
set seed126  1 O5 1 C1 1 C2
set resi1127  BGAL
set resi2127  AARB
set patch127  AP14AA
set seed127  1 O5 1 C1 1 C2
set resi1128  BGLC
set resi2128  AARB
set patch128  AP14AB
set seed128  1 O5 1 C1 1 C2
set resi1129  BGAL
set resi2129  BARB
set patch129  AP14BA
set seed129  1 O5 1 C1 1 C2
set resi1130  AGLC
set resi2130  BARB
set patch130  AP14BB
set seed130  1 O5 1 C1 1 C2



set count 1
label loop_carb1

if @count .le. 63 then
set residue @resi@@count
read sequence @residue 1

bomlev @boml
generate @residue first none last none setup warn drude dmass 0.4 !show
bomlev 0

else
read sequ card
*
2
@resi1@@count @resi2@@count
generate disa first none last none setup warn drude dmass 0.4 !show
patch @patch@@count disa 1 disa 2 setup warn drude dmass 0.4
bomlev 0
endif

ic param
ic seed @seed@@count
ic build 
coor sdrude
coor shake

! instead of relaxing Drude, move all Drude a little bit away from their parent atom
coor trans xdir -0.002 ydir -0.002 zdir -0.002 sele type D* end

update inbfrq -1 ihbfrq 0 switch atom vatom vswitch cutnb 999.0 ctofnb 997.0 ctonnb 995.0

if @mindr eq 0 then
  energy
 else
  cons harm force 100000. sele .not. type D* end
  mini ABNR nstep 200 nprint 20
  cons harm clear
 endif

 if @count .le. 63 then 
echo @residue starting E: ?ener
else
echo @resi1@@count-@resi2@@count-@patch@@count starting  E:  ?ener
endif
if @?pdbdir eq 1 then
  write psf card name @pdbdir/@residue.psf
  write coor pdb name @pdbdir/@residue_start.pdb
 endif

if @mini ne 0 then
  mini sd nstep 1000 tolgrd 0.0001 nprint 100
  if ?grms gt 0.0001 mini abnr nstep 1000 tolgrd 0.0001
  if ?grms gt 0.0001 then
    echo FATAL ERROR: MINIMIZATION NOT CONVERGED
    echu
    echo FATAL ERROR: MINIMIZATION NOT CONVERGED
    stop
   endif
  if @count .le. 63 then 
    echo @residue minimized E: ?ener
  else
    echo @resi1@@count-@resi2@@count-@patch@@count minimized  E:  ?ener
  endif  
  if @?pdbdir eq 1 then ! cannot use 1-line syntax because substitution will fail
    write coor pdb name @pdbdir/@residue_min.pdb
   endif
 endif

coor orient
coor dipole oxyz select all end 
echo @residue dipole: ?rdip
!! Check molecular polarizability
!VIBRAN
!diag dscf fini step 0.001
!END

shake off
drude reset
lone clear
delete atom sele all end

incr count
if count le @nres goto loop_carb1
